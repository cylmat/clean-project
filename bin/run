#!/usr/bin/env bash

# HELP #
display_usage() {
    echo "\
Usage:
  run [command]
HELP
  help              h       show list of commands
DOCKER COMMAND
  build_container   build
  build_and_run     bnr
  connect_container co
  reload
  stop_container    stop
  stop_and_remove   snr";
}

##############
### DOCKER ###
##############

build_container() {
  if [[ -f ./.env.local ]]; then
    docker compose --env-file=./.env.local -f docker-compose.yml up --build
  else
	  docker compose -f docker-compose.yml up --build
  fi
}

up_container() {
  docker compose -f docker-compose.yml up -d
}

up_build_container() {
  ${SHELL} "$0" build
  ${SHELL} "$0" up
}

down_container() {
  docker compose -f docker-compose.yml down --remove-orphans
}

reload_container() {
  ${SHELL} "$0" up
  ${SHELL} "$0" down
}

connect_container() {
	docker exec -it project bash
}

if [[ -z "$@" ]]; then
    display_usage
fi

for opt in "$@"; do
    case $opt in
        build)
          build_container
        ;;
        up)
          up_container
        ;;
        upb)
          up_build_container
        ;;
        down)
          down_container
        ;;
        reload)
          reload_container
        ;;
        bnr)
          build_and_run
        ;;
        co)
          connect_container
        ;;
        stop)
          stop_container
        ;;
        rm)
          remove_container
        ;;
        snr)
          stop_and_remove
        ;;
        # help
        help|h|--help)
            display_usage
        ;;
    esac
done
