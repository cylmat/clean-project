#!/usr/bin/env bash

# Function to display help
function show_help() {
  echo "üõà Usage: $0 <recipe> <container_name>"
  echo
  echo "Install 'recipe' in 'container_name'."
  echo "Example: $0 express node_container"
}

# Check if the argument is provided
if [ -z "$1" ]; then
  echo "‚ùå Error: No recipe provided."
  echo
  show_help
  exit 1
elif [ -z "$2" ]; then
  echo "‚ùå Error: No container name provided."
  echo
  show_help
  exit 1
fi

# Check if the user asked for help
if [[ "$1" == "--help" || "$1" == "-h" || "$1" == "help" ]]; then
  show_help
  exit 0
fi

RECIPE=$1
CONTAINER=$2
RECIPE_PATH=$(find .recipes -type f -name "${RECIPE}")
BASEPATH=$(echo "${RECIPE_PATH}" | rev | cut -d/ -f2- | rev)

function install_recipe_root() {
  if [ -z "${RECIPE_PATH}" ]; then echo "‚ùå Error: No recipe named '${RECIPE}' found."; fi

	docker exec ${CONTAINER} sh -c "mkdir -m 755 -p /tmp/${BASEPATH}"
	docker cp ${RECIPE_PATH} ${CONTAINER}:/tmp/${BASEPATH}/${RECIPE}
	docker exec -u root ${CONTAINER} sh -c "chmod a+x -R /tmp/${BASEPATH} && /tmp/${BASEPATH}/${RECIPE}"
}

install_recipe_root
